// ========================================
// 高市総理 Q&A ナレッジベース
// 政権公約2026 + 選挙結果 + 政策情報
// ========================================

const ELECTION_DATA = {
    date: "2026年2月8日",
    name: "第51回衆議院議員総選挙",
    totalSeats: 465,
    turnout: "56.26%",
    dissolution: "2026年1月23日（通常国会冒頭解散）",
    campaignDays: 16,
    parties: [
        { name: "自由民主党", seats: 316, color: "#C8102E", prev: null },
        { name: "中道改革連合", seats: 49, color: "#1E88E5", prev: 167 },
        { name: "日本維新の会", seats: 36, color: "#2E7D32", prev: null },
        { name: "国民民主党", seats: 28, color: "#FF8F00", prev: 27 },
        { name: "参政党", seats: 15, color: "#7B1FA2", prev: null },
        { name: "チームみらい", seats: 11, color: "#00ACC1", prev: 0 },
        { name: "日本共産党", seats: 4, color: "#D32F2F", prev: null },
        { name: "れいわ新選組", seats: 1, color: "#E91E63", prev: null },
        { name: "その他", seats: 5, color: "#78909C", prev: null }
    ]
};

const POLICY_CATEGORIES = [
    {
        id: "economy",
        title: "経済・財政",
        icon: "💰",
        summary: "責任ある積極財政で「強い経済」を構築",
        details: [
            {
                subtitle: "責任ある積極財政",
                content: "大胆かつ戦略的な「危機管理投資」と「成長投資」を推進。複数年度の予算措置や新たな財源確保の枠組みを検討し、官民連携で成長分野への戦略的投資を進めます。"
            },
            {
                subtitle: "物価高対策・消費税",
                content: "食料品を2年間、消費税の対象から除外。具体的な制度設計や財源は、政府・与党で設置する「国民会議」で検討します。"
            },
            {
                subtitle: "給付付き税額控除",
                content: "中低所得者や現役世代の手取りを増やすため、「給付付き税額控除」を実現。所得に応じて手取りが増える仕組みを導入します。"
            },
            {
                subtitle: "戦略分野への投資",
                content: "製薬・バイオを含む17の戦略分野に集中投資。製薬産業を基幹産業と位置づけ、創薬力の抜本的強化、創薬ベンチャー支援、バイオ医薬品の生産体制整備を推進します。"
            },
            {
                subtitle: "スタートアップ支援",
                content: "急成長スタートアップの創出に向け、政府・大企業によるイノベーション調達の強化、成長資金の拡大、研究開発から量産までの一貫支援、グローバル展開支援に取り組みます。"
            },
            {
                subtitle: "社会保険料負担の軽減",
                content: "現役世代を含む中・低所得者の税・社会保険料負担を軽減し、「給付付き税額控除」の制度設計を進め、手取り収入の増加を図ります。"
            }
        ],
        keywords: ["経済", "財政", "消費税", "税金", "減税", "物価", "給料", "手取り", "所得", "賃金", "スタートアップ", "投資", "成長", "景気", "財源", "積極財政", "インフレ", "デフレ", "GDP", "給付", "税額控除", "社会保険料", "製薬", "バイオ", "補助金"]
    },
    {
        id: "security",
        title: "安全保障・外交",
        icon: "🛡️",
        summary: "防衛力強化と自律的な安全保障体制の構築",
        details: [
            {
                subtitle: "防衛費GDP2%",
                content: "2025年度までに防衛費をGDP比2%に引き上げ（当初計画より2年前倒し）。2026年には安全保障関連3文書の改定を予定しています。"
            },
            {
                subtitle: "日米同盟とFOIP",
                content: "日米同盟を基軸とし、「自由で開かれたインド太平洋（FOIP）」を力強く推進。国際社会の平和と安定に積極的に貢献します。"
            },
            {
                subtitle: "経済安全保障",
                content: "サプライチェーンの強靭化、半導体・蓄電池など「特定重要物資」の国内確保、技術流出防止を推進。外国企業の買収に対する厳格な審査を実施します。"
            },
            {
                subtitle: "日本版CFIUS",
                content: "外国からの投資を厳格に審査する「対日外国投資委員会」（日本版CFIUS）の創設を目指し、外国資本による土地取得規制を強化する法案を国会に提出予定です。"
            },
            {
                subtitle: "サイバー安全保障",
                content: "デジタル大臣がサイバー安全保障を担当し、政府全体のサイバーセキュリティ対策を強化。複合的な危機にも対応できる安全保障体制を実現します。"
            },
            {
                subtitle: "外国人政策",
                content: "出入国在留管理や税・社会保障制度の見直し。外国人の住宅・土地取得の把握、安全保障上の懸念払拭、外国人が日本の文化・ルールを理解できる環境整備を進めます。"
            }
        ],
        keywords: ["安全保障", "防衛", "外交", "軍事", "自衛隊", "米軍", "日米同盟", "中国", "北朝鮮", "ミサイル", "核", "戦争", "平和", "インド太平洋", "FOIP", "サイバー", "CFIUS", "外国人", "移民", "土地", "スパイ", "技術流出", "半導体"]
    },
    {
        id: "digital",
        title: "デジタル・AI",
        icon: "🤖",
        summary: "AIと半導体を経済安全保障の中核インフラに",
        details: [
            {
                subtitle: "AI基本計画",
                content: "AI基本計画を策定し、AIのイノベーション推進とリスク対応を両立。生成AIの開発、産業とAIの融合、AIロボティクスの研究開発を支援し、行政分野へのAI実装を進めます。"
            },
            {
                subtitle: "半導体戦略",
                content: "先端・次世代半導体の技術開発を支援し、設計から製造まで国内で完結するシステムの構築を目指します。"
            },
            {
                subtitle: "フィジカルAI",
                content: "AI分野への10兆円以上の公的支援を活用し、50兆円超の官民投資を促進。約160兆円の経済波及効果で、精密なものづくり工場の無人制御を実現する「フィジカルAI」を目指します。"
            },
            {
                subtitle: "デジタルインフラ",
                content: "光電融合技術による「オール光ネットワーク」を中核とした次世代情報通信基盤の社会実装。データセンター・国際海底ケーブルの地方分散でデジタルインフラを強靭化します。"
            },
            {
                subtitle: "GIGAスクール",
                content: "「GIGAスクール構想のさらなる前進」を通じて個別最適な学びを実現し、教育DXや生成AIの活用を推進します。"
            }
        ],
        keywords: ["AI", "人工知能", "デジタル", "IT", "テクノロジー", "半導体", "DX", "ロボット", "データ", "ネットワーク", "5G", "光ファイバー", "サイバー", "プログラミング", "ChatGPT", "生成AI", "データセンター", "クラウド", "スマート", "IoT"]
    },
    {
        id: "energy",
        title: "エネルギー・食料安全保障",
        icon: "⚡",
        summary: "純国産エネルギーと攻めの農業で自給力強化",
        details: [
            {
                subtitle: "原子力政策",
                content: "原子力発電の再稼働を推進。次世代炉（SMR：小型モジュール炉）や核融合（フュージョンエネルギー）の早期社会実装を目指します。"
            },
            {
                subtitle: "再生可能エネルギー",
                content: "ペロブスカイト太陽電池の普及、省エネ型データセンターの普及、酸化物型全固体電池の社会実装など、純国産エネルギー技術の開発を推進します。"
            },
            {
                subtitle: "食料安全保障",
                content: "食料自給率の向上に向け、通常予算以外に2.5兆円の予算措置。農地の大区画化、老朽化した農業施設の集約・再編、スマート農業の普及を通じ、2029年度までに農業構造の集中転換を目指します。"
            },
            {
                subtitle: "攻めの農業",
                content: "2030年までに農産物輸出額5兆円を目標とする「攻めの農業」を提唱。スマート農業の導入、農地の大区画化による構造改革を推進します。"
            }
        ],
        keywords: ["エネルギー", "原発", "原子力", "電力", "電気", "太陽光", "再エネ", "再生可能エネルギー", "核融合", "食料", "農業", "自給率", "農家", "食べ物", "米", "コメ", "食品", "ペロブスカイト", "電池", "蓄電池", "EV", "電気自動車", "カーボンニュートラル", "脱炭素"]
    },
    {
        id: "childcare",
        title: "少子化・子育て",
        icon: "👶",
        summary: "3.6兆円規模の支援で少子化を克服",
        details: [
            {
                subtitle: "こども未来戦略",
                content: "少子化を国家的危機と捉え克服を最優先課題に。「こども未来戦略」加速化プランに基づき、3.6兆円規模の支援策を着実に実施します。"
            },
            {
                subtitle: "出産費用無償化",
                content: "妊娠・出産に伴う経済的負担を軽減するため、標準的な出産費用の無償化を検討。関連法案を次期国会に提出予定です。"
            },
            {
                subtitle: "こども誰でも通園制度",
                content: "保護者の就労状況に関わらず、すべてのこどもが保育施設を利用できる「こども誰でも通園制度」の本格実施を進めます。"
            },
            {
                subtitle: "育児休業給付",
                content: "男女ともに実質10割となる育児休業給付の水準を目指し、男性の育児休業取得を促進します。"
            },
            {
                subtitle: "子ども・子育て支援金制度",
                content: "2026年度から新制度を導入。徹底した歳出改革により実質的な国民負担を生じさせずに必要な財源を確保します。"
            },
            {
                subtitle: "ベビーシッター・家事支援",
                content: "育児や介護による離職を減らすため、ベビーシッターや家事支援サービスの利用促進に向けた負担軽減に取り組みます。"
            }
        ],
        keywords: ["少子化", "子育て", "育児", "出産", "妊娠", "子ども", "こども", "赤ちゃん", "保育", "保育園", "幼稚園", "育休", "産休", "ベビーシッター", "待機児童", "児童手当", "家族", "結婚", "婚姻", "出生率", "人口減少"]
    },
    {
        id: "education",
        title: "教育",
        icon: "🎓",
        summary: "幼児期から社会人まで一貫した公教育の質向上",
        details: [
            {
                subtitle: "高校授業料無償化",
                content: "2026年度からの新たな就学支援金制度により「高校授業料無償化」を着実に実施します。"
            },
            {
                subtitle: "教育DX・GIGAスクール",
                content: "GIGAスクール構想を前進させ、個別最適な学びを実現。教育DXや生成AIの活用を推進します。"
            },
            {
                subtitle: "多様な学びの環境",
                content: "小中一貫教育の推進、飛び級制度、フリースクール、インターナショナルスクールなどの学校外教育の環境整備を進めます。"
            },
            {
                subtitle: "品格ある国家づくり",
                content: "日本に生まれたことを誇りに思える品格ある国家を目指し、自助自立と家族・地域・国への帰属意識を持つ国民の育成に取り組みます。"
            }
        ],
        keywords: ["教育", "学校", "大学", "高校", "中学", "小学校", "授業料", "無償化", "奨学金", "先生", "教師", "受験", "入試", "学費", "飛び級", "フリースクール", "GIGAスクール", "タブレット", "プログラミング教育"]
    },
    {
        id: "regional",
        title: "地方創生",
        icon: "🏘️",
        summary: "地域の伸びしろを最大限に活かし豊かな地方へ",
        details: [
            {
                subtitle: "地域未来戦略",
                content: "地域ごとの産業クラスターを戦略的に形成し、地方への大規模な投資を呼び込みます。地方の伸びしろと地域特性を最大限に活かします。"
            },
            {
                subtitle: "東京一極集中の是正",
                content: "地方への移住促進、二地域居住などによる地域との多様なつながりの創出を支援します。"
            },
            {
                subtitle: "デジタル田園都市",
                content: "5Gやオール光ネットワークを活用し、遠隔医療、遠隔教育、社会インフラの維持管理、地域産業の活性化を進めます。"
            },
            {
                subtitle: "地方財源の安定確保",
                content: "地方税や地方交付税など、地方の一般財源を安定的に確保。地方のDX・GX（デジタル変革・グリーン変革）や地域防災力の強化を加速させます。"
            }
        ],
        keywords: ["地方", "地方創生", "田舎", "過疎", "地域", "移住", "東京一極集中", "人口流出", "町おこし", "観光", "インバウンド", "ふるさと", "交付税", "地方税", "二地域居住", "テレワーク", "リモートワーク"]
    },
    {
        id: "constitution",
        title: "憲法改正",
        icon: "📜",
        summary: "自衛隊明記など4項目の憲法改正を推進",
        details: [
            {
                subtitle: "改正4項目",
                content: "①自衛隊の明記、②緊急事態対応、③合区解消・地方公共団体、④教育の充実 — の4項目を中心に憲法改正の発議と国民投票の早期実施を目指します。"
            },
            {
                subtitle: "皇位継承",
                content: "安定的な皇位継承のため、皇室典範の改正を目指し、皇族には認められていない養子縁組を可能とすることを検討しています。"
            },
            {
                subtitle: "旧氏使用の法制化",
                content: "旧氏使用の通称利用の法制化も掲げており、選択的夫婦別姓に関する議論にも対応しています。"
            }
        ],
        keywords: ["憲法", "憲法改正", "改憲", "自衛隊", "9条", "緊急事態", "国民投票", "皇室", "天皇", "皇位継承", "夫婦別姓", "旧姓", "合区", "護憲"]
    }
];

// ========================================
// Q&A応答テンプレート
// ========================================
const QA_RESPONSES = {
    greeting: [
        "こんにちは！第104代内閣総理大臣の高市早苗です。日本の政治や私たちの政策について、何でもお聞きください。「日本列島を、強く豊かに。」のビジョンのもと、お答えいたします。",
        "ようこそ！高市早苗です。私たち自民党の政権公約2026について、ぜひお気軽にご質問ください。国民の皆様と一緒に、強く豊かな日本を創っていきたいと考えています。",
        "お越しいただきありがとうございます！高市早苗です。経済、外交、教育、子育て…どんなテーマでもお答えします。日本をもっと強く、もっと豊かにするための政策を一緒に考えましょう。"
    ],

    election: "2026年2月8日の第51回衆議院選挙では、自民党が316議席を獲得し、単独で全465議席の3分の2を超える歴史的な勝利を収めました。投票率は56.26%で、前回（53.85%）から2.41ポイント上昇しました。期日前投票は過去最多の約2,079万人に達しています。\n\nこの結果は、私たちの「日本列島を、強く豊かに。」というビジョンに対する国民の皆様からの強い信任と受け止め、責任を持って政策を実行してまいります。\n\n主な争点は物価高対策（食料品の消費税免除）や外国人政策、防衛力強化などでした。",

    primeMinister: "私、高市早苗は2025年10月4日に自由民主党総裁に選出され、10月21日に第104代内閣総理大臣に指名されました。\n\n「経済安全保障」を政策の柱に据え、「責任ある積極財政」のもと、危機管理投資と成長投資を推進しています。2025年12月時点で76.0%の高い支持率をいただいており、国民の皆様の期待に応えるべく全力で取り組んでおります。\n\n初の女性総理大臣として、多様な視点を活かした政策立案に力を入れています。",

    opposition: "今回の選挙では、各党の議席数に大きな変動がありました。\n\n**▸ 中道改革連合**（立憲民主党＋公明党）：167→49議席と大幅減。準備不足と理念の曖昧さが指摘されています。\n**▸ 日本維新の会**：36議席を獲得\n**▸ 国民民主党**：28議席（前回から微増）\n**▸ 参政党**：15議席と躍進\n**▸ チームみらい**：結党わずか9ヶ月で11議席を獲得し注目\n**▸ 日本共産党**：4議席\n**▸ れいわ新選組**：1議席\n\n野党の皆様の声にも真摯に耳を傾けつつ、建設的な議論を進めてまいります。",

    dissolution: "2026年1月23日、通常国会冒頭で衆議院を解散いたしました。\n\n解散から投開票までの期間は16日間と戦後最短でしたが、期日前投票は過去最多の約2,079万人、有権者の20%に達しました。物価高対策や外国人政策、防衛力の在り方などが主な争点となりました。\n\n迅速な解散判断でしたが、国民の皆様にしっかりと政策を届け、歴史的な信任をいただけたと考えています。",

    notFound: [
        "ご質問ありがとうございます。そのテーマについて直接的なお答えは難しいのですが、関連するかもしれない政策分野についてお話しさせてください。\n\n私たちの政策は「経済・財政」「安全保障・外交」「デジタル・AI」「エネルギー・食料」「少子化・子育て」「教育」「地方創生」「憲法改正」の8本の柱で構成されています。\n\n例えば「暮らしをよくしたい」「日本の未来はどうなる？」「税金は下がる？」といった身近なご質問にもお答えできますので、ぜひお試しください。",
        "ありがとうございます。そのテーマに関連する政策をお探ししましたが、もう少し具体的にお聞きいただけると、より的確にお答えできます。\n\n例えば：\n・家計に関すること →「給料は上がる？」「物価対策は？」\n・子育てに関すること →「保育園」「育休」「出産費用」\n・将来の不安 →「年金」「老後」「医療費」\n・国の安全 →「防衛費」「中国」「サイバー」\n\nお気軽にどうぞ！",
        "お問い合わせありがとうございます。幅広いテーマにお答えしていますので、ぜひ別の聞き方でもお試しください。\n\n人気の質問：\n・「消費税はどうなる？」\n・「少子化対策を教えて」\n・「AIで日本はどう変わる？」\n・「防衛費はいくら？」\n・「学費の無償化は？」\n\n日本の未来に関わるどんなことでもお答えします！"
    ]
};

// ========================================
// 巨大な同義語・口語表現辞書
// カジュアルな言い回し → カテゴリマッピング
// ========================================
const SYNONYM_DICTIONARY = {
    // === 経済・財政 ===
    "お金": "economy", "金": "economy", "カネ": "economy",
    "給料上がる": "economy", "賃上げ": "economy", "ベースアップ": "economy", "ベア": "economy",
    "値上げ": "economy", "物価高い": "economy", "高い": "economy", "値段": "economy",
    "生活苦しい": "economy", "生活費": "economy", "家計": "economy",
    "手取り少ない": "economy", "手取り増える": "economy",
    "税金高い": "economy", "増税": "economy", "減税": "economy",
    "買い物": "economy", "スーパー": "economy", "食費": "economy",
    "収入": "economy", "年収": "economy", "ボーナス": "economy",
    "株": "economy", "株価": "economy", "日経平均": "economy", "円安": "economy", "円高": "economy",
    "インフレ": "economy", "デフレ": "economy", "不況": "economy", "好景気": "economy",
    "公約": "economy", "起業": "economy", "ベンチャー": "economy",
    "中小企業": "economy", "大企業": "economy", "雇用": "economy", "仕事": "economy",
    "失業": "economy", "リストラ": "economy", "転職": "economy",
    "年金": "economy", "老後": "economy", "退職金": "economy",
    "iDeCo": "economy", "NISA": "economy", "貯金": "economy", "貯蓄": "economy",
    "住宅ローン": "economy", "ローン": "economy", "金利": "economy",
    "暮らし": "economy", "豊か": "economy", "裕福": "economy", "貧困": "economy", "格差": "economy",
    "最低賃金": "economy", "時給": "economy",

    // === 安全保障・外交 ===
    "戦争": "security", "戦": "security", "紛争": "security",
    "軍隊": "security", "軍": "security", "兵器": "security", "武器": "security",
    "ミサイル": "security", "核兵器": "security", "核弾頭": "security",
    "アメリカ": "security", "米国": "security", "トランプ": "security", "バイデン": "security",
    "中国": "security", "習近平": "security", "台湾": "security", "台湾有事": "security",
    "韓国": "security", "北朝鮮": "security", "金正恩": "security", "拉致": "security",
    "ロシア": "security", "プーチン": "security", "ウクライナ": "security",
    "領土": "security", "尖閣": "security", "竹島": "security", "北方領土": "security",
    "沖縄": "security", "基地": "security",
    "テロ": "security", "テロリスト": "security",
    "在日": "security", "外国人犯罪": "security", "不法滞在": "security",
    "ビザ": "security", "入管": "security", "難民": "security",
    "スパイ": "security", "工作員": "security", "諜報": "security",
    "国連": "security", "NATO": "security", "G7": "security", "サミット": "security",
    "条約": "security", "同盟": "security",
    "守る": "security", "危険": "security", "脅威": "security", "攻撃": "security",
    "国防": "security", "戦力": "security",

    // === デジタル・AI ===
    "パソコン": "digital", "スマホ": "digital", "アプリ": "digital",
    "インターネット": "digital", "ネット": "digital", "WiFi": "digital", "Wi-Fi": "digital",
    "SNS": "digital", "Twitter": "digital", "LINE": "digital", "YouTube": "digital",
    "マイナンバー": "digital", "マイナカード": "digital", "デジタル庁": "digital",
    "電子決済": "digital", "キャッシュレス": "digital",
    "自動運転": "digital", "ドローン": "digital",
    "ChatGPT": "digital", "Gemini": "digital", "Claude": "digital",
    "テック": "digital", "ハイテク": "digital", "最先端": "digital",
    "TSMC": "digital", "ラピダス": "digital", "Rapidus": "digital",
    "量子コンピュータ": "digital", "量子": "digital",
    "オンライン": "digital", "リモート": "digital",
    "ハッキング": "digital", "セキュリティ": "digital", "個人情報": "digital", "情報漏洩": "digital",

    // === エネルギー・食料 ===
    "電気代": "energy", "電気料金": "energy", "光熱費": "energy", "ガス代": "energy",
    "節電": "energy", "省エネ": "energy",
    "ソーラー": "energy", "太陽光パネル": "energy", "風力": "energy",
    "水素": "energy", "アンモニア": "energy",
    "原発事故": "energy", "放射能": "energy", "福島": "energy",
    "CO2": "energy", "温暖化": "energy", "気候変動": "energy", "環境": "energy",
    "食べ物高い": "energy", "食料危機": "energy",
    "農家大変": "energy", "後継者不足": "energy",
    "有機農業": "energy", "オーガニック": "energy",
    "漁業": "energy", "水産": "energy", "林業": "energy",
    "輸入": "energy", "輸出": "energy", "関税": "energy",
    "食の安全": "energy", "食品安全": "energy",
    "ガソリン": "energy", "灯油": "energy", "石油": "energy", "天然ガス": "energy",

    // === 少子化・子育て ===
    "赤ちゃん": "childcare", "子供": "childcare", "子ども": "childcare",
    "ママ": "childcare", "パパ": "childcare", "お母さん": "childcare", "お父さん": "childcare",
    "共働き": "childcare", "ワンオペ": "childcare", "ワンオペ育児": "childcare",
    "産む": "childcare", "産みたい": "childcare", "産めない": "childcare",
    "不妊": "childcare", "不妊治療": "childcare",
    "保活": "childcare", "入園": "childcare", "認可保育園": "childcare",
    "学童": "childcare", "放課後": "childcare",
    "おむつ": "childcare", "ミルク": "childcare",
    "児童虐待": "childcare", "虐待": "childcare",
    "シングルマザー": "childcare", "ひとり親": "childcare", "母子家庭": "childcare",
    "離婚": "childcare", "養育費": "childcare",
    "少子高齢化": "childcare", "人口": "childcare",
    "出生数": "childcare", "合計特殊出生率": "childcare",
    "若者": "childcare", "恋愛": "childcare", "婚活": "childcare", "マッチングアプリ": "childcare",

    // === 教育 ===
    "勉強": "education", "学び": "education", "習い事": "education",
    "塾": "education", "予備校": "education", "家庭教師": "education",
    "偏差値": "education", "成績": "education", "テスト": "education",
    "いじめ": "education", "不登校": "education", "引きこもり": "education",
    "部活": "education", "スポーツ": "education",
    "留学": "education", "海外": "education",
    "研究者": "education", "研究": "education", "科学": "education",
    "AI教育": "education", "STEM": "education",
    "学歴": "education", "学力": "education",
    "給食": "education", "通学": "education", "スクールバス": "education",
    "PTA": "education", "保護者": "education",
    "オルタナティブ": "education", "ホームスクール": "education",
    "博士": "education", "修士": "education", "院生": "education",

    // === 地方創生 ===
    "田舎暮らし": "regional", "Uターン": "regional", "Iターン": "regional",
    "空き家": "regional", "廃墟": "regional", "限界集落": "regional",
    "シャッター商店街": "regional", "商店街": "regional",
    "災害": "regional", "地震": "regional", "台風": "regional", "豪雨": "regional", "津波": "regional",
    "インフラ": "regional", "道路": "regional", "橋": "regional", "トンネル": "regional",
    "電車": "regional", "バス": "regional", "交通": "regional", "公共交通": "regional",
    "病院": "regional", "医者": "regional", "医療": "regional", "介護": "regional", "介護士": "regional",
    "老人ホーム": "regional", "福祉": "regional",
    "温泉": "regional", "祭り": "regional", "伝統": "regional", "文化": "regional",
    "地方移住": "regional", "ワーケーション": "regional",
    "ふるさと納税": "regional", "納税": "regional",

    // === 憲法改正 ===
    "国民投票": "constitution", "レファレンダム": "constitution",
    "9条": "constitution", "九条": "constitution",
    "平和主義": "constitution", "戦力不保持": "constitution",
    "交戦権": "constitution", "専守防衛": "constitution",
    "有事": "constitution", "非常事態": "constitution", "戒厳令": "constitution",
    "人権": "constitution", "基本的人権": "constitution",
    "表現の自由": "constitution", "言論の自由": "constitution",
    "男女平等": "constitution", "ジェンダー": "constitution", "LGBT": "constitution",
    "皇室典範": "constitution", "皇太子": "constitution",
    "参議院": "constitution", "選挙区": "constitution",
    "女系天皇": "constitution", "男系天皇": "constitution", "女性天皇": "constitution",

    // === 選挙関連 ===
    "選挙": "election", "投票": "election", "開票": "election",
    "衆院選": "election", "衆議院": "election", "議席": "election",
    "当選": "election", "落選": "election", "候補者": "election",
    "選挙区": "election", "比例": "election", "比例代表": "election",
    "政権交代": "election", "一票": "election",

    // === 総理・内閣 ===
    "総理": "primeMinister", "首相": "primeMinister",
    "高市": "primeMinister", "高市早苗": "primeMinister", "高市さん": "primeMinister",
    "内閣": "primeMinister", "大臣": "primeMinister", "閣僚": "primeMinister",
    "支持率": "primeMinister", "内閣支持率": "primeMinister",
    "女性総理": "primeMinister", "女性首相": "primeMinister",
    "政権": "primeMinister", "自民党総裁": "primeMinister",
    "所信表明": "primeMinister", "施政方針": "primeMinister",
    "経歴": "primeMinister", "プロフィール": "primeMinister",
    "リーダー": "primeMinister", "リーダーシップ": "primeMinister",
    "誰": "primeMinister", "何者": "primeMinisher",
    "あなた": "primeMinister", "あんた": "primeMinister",
    "自己紹介": "primeMinister",

    // === 野党 ===
    "野党": "opposition", "立憲": "opposition", "公明": "opposition",
    "維新": "opposition", "共産": "opposition", "国民民主": "opposition",
    "れいわ": "opposition", "参政党": "opposition", "チームみらい": "opposition",
    "中道改革連合": "opposition", "与党": "opposition",
    "対立": "opposition", "反対派": "opposition",
    "野党共闘": "opposition", "連立": "opposition",

    // === 解散 ===
    "解散": "dissolution", "奇襲解散": "dissolution", "冒頭解散": "dissolution",
    "なぜ解散": "dissolution", "解散理由": "dissolution", "解散時期": "dissolution",

    // === 追加：生活関連の口語表現 ===
    "やばい": "economy", "ヤバい": "economy", "きつい": "economy", "厳しい": "economy",
    "苦しい": "economy", "どうしよう": "economy", "困った": "economy", "困ってる": "economy",
    "不安": "economy", "心配": "economy", "大丈夫": "economy",
    "払えない": "economy", "高すぎ": "economy", "高すぎる": "economy",
    "もったいない": "economy", "節約": "economy", "やりくり": "economy",
    "副業": "economy", "ダブルワーク": "economy", "パート": "economy", "アルバイト": "economy",
    "非正規": "economy", "契約社員": "economy", "派遣": "economy", "フリーランス": "economy",
    "ブラック企業": "economy", "残業": "economy", "過労": "economy", "働き方改革": "economy",
    "テレワーク": "economy", "在宅勤務": "economy",
    "物価": "economy", "インフレ率": "economy", "消費者物価": "economy",
    "103万": "economy", "103万の壁": "economy", "106万の壁": "economy", "130万の壁": "economy",
    "扶養": "economy", "壁": "economy",

    // === 追加：医療・健康 ===
    "健康": "regional", "病気": "regional", "入院": "regional", "手術": "regional",
    "薬": "regional", "薬代": "regional", "医療費": "regional", "医療費高い": "regional",
    "救急車": "regional", "救急": "regional", "ドクター": "regional",
    "コロナ": "regional", "パンデミック": "regional", "感染症": "regional", "ワクチン": "regional",
    "メンタルヘルス": "regional", "うつ": "regional", "鬱": "regional", "ストレス": "regional",
    "自殺": "regional", "孤独": "regional", "引きこもり": "regional",
    "障害者": "regional", "障がい者": "regional", "バリアフリー": "regional",

    // === 追加：住宅 ===
    "家": "economy", "マンション": "economy", "住宅": "economy", "賃貸": "economy",
    "家賃": "economy", "家賃高い": "economy", "引っ越し": "economy",
    "持ち家": "economy", "住宅価格": "economy", "不動産": "economy",

    // === 追加：交通・インフラ ===
    "新幹線": "regional", "リニア": "regional", "高速道路": "regional",
    "飛行機": "regional", "空港": "regional", "港": "regional",
    "渋滞": "regional", "満員電車": "regional", "通勤": "regional",
    "タクシー": "regional", "ライドシェア": "regional",

    // === 追加：文化・スポーツ ===
    "オリンピック": "education", "ワールドカップ": "education",
    "映画": "education", "アニメ": "education", "漫画": "education", "ゲーム": "education",
    "クールジャパン": "education", "文化芸術": "education", "伝統工芸": "education",
    "観光": "regional", "インバウンド": "regional", "外国人観光客": "regional",

    // === 追加：移民・外国人 ===
    "移民": "security", "外国人": "security", "外国人労働者": "security",
    "技能実習": "security", "特定技能": "security",
    "多文化": "security", "国際化": "security",

    // === 追加：社会問題 ===
    "犯罪": "security", "治安": "security", "警察": "security",
    "詐欺": "security", "オレオレ詐欺": "security", "特殊詐欺": "security",
    "闇バイト": "security", "反社": "security",
    "薬物": "security", "大麻": "security",
    "DV": "childcare", "家庭内暴力": "childcare",
    "貧困家庭": "childcare", "子供の貧困": "childcare", "こどもの貧困": "childcare",
    "ヤングケアラー": "childcare", "児童手当": "childcare",
    "NPO": "regional", "ボランティア": "regional", "NPO法人": "regional"
};

// ========================================
// 複合トピック（カテゴリ横断の質問パターン）
// 大幅拡充：20+パターン
// ========================================
const COMPOSITE_TOPICS = [
    // === くらし全般 ===
    {
        patterns: ["生活", "暮らし向き", "日々の暮らし", "普段の生活", "庶民", "国民の暮らし"],
        categories: ["economy", "childcare", "energy"],
        response: "国民の皆様の生活に直結する政策について、お答えいたします。\n\n**▸ 物価高対策**\n食料品を2年間、消費税の対象から除外します。また「給付付き税額控除」により、中低所得者や現役世代の手取りを増やします。\n\n**▸ エネルギーコスト**\n電力の安定供給と価格抑制のため、原子力発電の再稼働や再生可能エネルギーの推進に取り組みます。\n\n**▸ 子育て支援**\n出産費用の無償化、育児休業給付の実質10割化、「こども誰でも通園制度」など、3.6兆円規模の支援を実施します。\n\n国民一人ひとりが豊かさを実感できる社会を目指しています。"
    },
    // === 日本の未来 ===
    {
        patterns: ["未来", "将来", "これから", "今後", "日本の将来", "日本の未来", "10年後", "20年後", "50年後", "次の世代"],
        categories: ["economy", "digital", "energy"],
        response: "日本の未来について、お答えいたします。\n\n私は「日本列島を、強く豊かに。」というビジョンのもと、日本の将来を見据えた政策を推進しています。\n\n**▸ 経済の未来**\n「責任ある積極財政」により、17の戦略分野への集中投資で経済を力強く成長させます。\n\n**▸ デジタル・AIの未来**\nAI分野への10兆円超の公的支援で、約160兆円の経済波及効果を目指します。「フィジカルAI」による工場の無人制御など、世界をリードする技術大国へ。\n\n**▸ エネルギーの未来**\n次世代原子炉、核融合、ペロブスカイト太陽電池など、純国産エネルギー技術の開発で持続可能な社会を実現します。\n\n日本の底力を信じ、次の世代に誇れる国を創っていきます。"
    },
    // === 政策まとめ ===
    {
        patterns: ["全部", "まとめ", "要約", "概要", "全体", "一覧", "ざっくり", "簡単に", "どんな政策", "何やるの", "公約教えて", "政策は何"],
        categories: [],
        response: "私たちの「政権公約2026」の全体像をお話しします。「日本列島を、強く豊かに。」をスローガンに、8つの柱で政策を推進しています。\n\n💰 **経済・財政** — 食料品消費税免除、給付付き税額控除、17戦略分野への投資\n🛡️ **安全保障** — 防衛費GDP2%、日本版CFIUS、サイバー安全保障\n🤖 **デジタル・AI** — AI基本計画、半導体国産化、160兆円の経済波及効果\n⚡ **エネルギー・食料** — 原発再稼働、スマート農業、農産物輸出5兆円\n👶 **少子化・子育て** — 3.6兆円支援、出産無償化、育休10割給付\n🎓 **教育** — 高校授業料無償化、GIGAスクール、飛び級制度\n🏘️ **地方創生** — 産業クラスター、東京一極集中是正、デジタル田園都市\n📜 **憲法改正** — 自衛隊明記、緊急事態、合区解消、教育充実\n\n気になる分野があれば、ぜひ詳しくお聞きください！"
    },
    // === 女性 ===
    {
        patterns: ["女性", "女性活躍", "ガラスの天井", "初の女性", "ワーキングマザー", "女性の社会進出", "男女格差"],
        categories: ["childcare", "economy"],
        response: "女性の活躍と支援についてお答えいたします。\n\n私は初の女性総理大臣として、女性が活躍できる社会の実現に強い思いを持っています。\n\n**▸ 子育てと仕事の両立**\n育児休業給付を男女ともに実質10割に引き上げ。ベビーシッター・家事支援サービスの負担軽減で、育児による離職を防ぎます。\n\n**▸ 経済的支援**\n出産費用の無償化、「こども誰でも通園制度」の本格実施、シングルマザーを含むひとり親世帯への支援を充実させます。\n\n**▸ 経済参画**\n中低所得者の手取りを増やす「給付付き税額控除」、女性起業家支援を含むスタートアップ支援を推進します。\n\n性別に関係なく、誰もが能力を発揮できる社会を目指しています。"
    },
    // === 高齢者 ===
    {
        patterns: ["高齢者", "お年寄り", "シニア", "老人", "認知症", "年金不安", "老後不安", "おばあちゃん", "おじいちゃん", "祖父母"],
        categories: ["economy", "regional"],
        response: "高齢者の皆様の暮らしと福祉についてお答えいたします。\n\n**▸ 年金・社会保障**\n社会保険料負担の軽減と「給付付き税額控除」により、年金生活者を含む中低所得者の手取りを増やします。\n\n**▸ 医療・介護の充実**\n地域医療・介護の基盤を守るため、医療・福祉・介護分野で働く幅広い職種の確実な賃上げを図ります。担い手不足の解消に全力で取り組みます。\n\n**▸ 地域の見守り**\n5Gやデジタル技術を活用した遠隔医療の推進、地域の見守りネットワークの構築を進めます。\n\n**▸ 物価高対策**\n食料品の消費税免除は、特に年金生活者の皆様の家計を直接支える政策です。\n\n高齢者の皆様が安心して暮らせる社会を実現してまいります。"
    },
    // === 若者・学生 ===
    {
        patterns: ["若者", "若い人", "学生", "大学生", "高校生", "Z世代", "20代", "新卒", "就活", "内定"],
        categories: ["education", "economy", "childcare"],
        response: "若い世代の皆様に向けた政策について、お答えいたします。\n\n**▸ 教育費の負担軽減**\n高校授業料の完全無償化（所得制限なし）を実現し、大学・専門学校の奨学金制度を拡充。返済不要の給付型奨学金を大幅に増やします。\n\n**▸ 就職・キャリア支援**\nスタートアップ支援や中小企業の賃上げ促進により、若い世代が挑戦できる経済環境を整えます。最低賃金の引き上げにも取り組みます。\n\n**▸ 結婚・出産の経済支援**\n出産費用の無償化、新婚世帯への住宅支援、「給付付き税額控除」で若い世帯の手取りを増やし、将来への不安を減らします。\n\n**▸ デジタルスキル**\nGIGAスクール構想の推進、AI・データサイエンス教育の充実で、世界で活躍できる人材を育てます。\n\n若い世代が希望を持てる日本を、一緒に創っていきましょう。"
    },
    // === 働く世代・サラリーマン ===
    {
        patterns: ["サラリーマン", "会社員", "社畜", "働く", "仕事きつい", "労働者", "ワークライフバランス", "残業多い", "給料安い", "転職したい"],
        categories: ["economy", "digital"],
        response: "働く皆様の暮らしと待遇についてお答えいたします。\n\n**▸ 手取りの増加**\n「給付付き税額控除」の導入で、中低所得の勤労者の手取りを直接増やします。社会保険料負担の軽減にも取り組みます。いわゆる「年収の壁」の見直しも進めます。\n\n**▸ 賃上げの推進**\n中小企業を含む幅広い企業での持続的な賃上げを実現するため、生産性向上支援と「賃上げ税制」を強化します。最低賃金の引き上げも進めます。\n\n**▸ 多様な働き方**\nテレワーク・副業の環境整備、フリーランスの保護強化。リスキリング（学び直し）支援で、転職やキャリアアップを後押しします。\n\n**▸ デジタルによる効率化**\nAI・デジタル技術の活用で業務効率化を進め、長時間労働の是正と生産性向上を両立させます。\n\n汗を流して働く皆様が報われる経済を必ず実現します。"
    },
    // === 税金全般 ===
    {
        patterns: ["税金", "税制", "確定申告", "所得税", "住民税", "相続税", "税金の使い道", "無駄遣い", "税金高い", "増税するの"],
        categories: ["economy"],
        response: "税制についてお答えいたします。\n\n**▸ 食料品の消費税免除**\n2年間、食料品を消費税の対象から除外し、家計の負担を直接軽減します。\n\n**▸ 給付付き税額控除**\n中低所得者を対象に、税額控除と給付を組み合わせた新しい制度を導入。手取りを実質的に増やします。\n\n**▸ 社会保険料の軽減**\n現役世代の負担が重い社会保険料を見直し、制度の持続可能性を確保しつつ手取りを増やします。\n\n**▸ 戦略的な財政運営**\n「責任ある積極財政」のもと、危機管理と成長分野への投資を優先。無駄な支出を省きつつ、必要な投資は大胆に行います。\n\n国民の皆様に「税金がちゃんと使われている」と実感していただける政治を目指しています。"
    },
    // === 医療・健康 ===
    {
        patterns: ["病院", "医療", "健康", "医者", "入院", "手術", "薬", "健康保険", "医療費高い", "病気", "健康診断"],
        categories: ["regional", "economy"],
        response: "医療と健康についてお答えいたします。\n\n**▸ 地域医療の充実**\n医師の偏在解消、遠隔医療の推進、地域の中核病院の機能強化に取り組みます。どこに住んでいても質の高い医療を受けられる社会を目指します。\n\n**▸ 医療従事者の待遇改善**\n医師・看護師・介護士など、医療・福祉分野で働く方々の確実な賃上げを進めます。\n\n**▸ 創薬・バイオ産業**\n日本発の革新的な医薬品・医療機器の開発を支援。製薬・バイオ産業を17の戦略産業の一つとして育成します。\n\n**▸ デジタルヘルス**\nマイナ保険証の活用やオンライン診療の拡充で、より便利で効率的な医療サービスを実現します。\n\n国民の皆様の健康と命を守ることは、政治の最も重要な責務です。"
    },
    // === 年金 ===
    {
        patterns: ["年金", "年金制度", "年金もらえる", "年金足りない", "年金破綻", "老後の資金", "老後2000万", "iDeCo", "NISA"],
        categories: ["economy"],
        response: "年金・老後の資産形成についてお答えいたします。\n\n**▸ 年金制度の安定化**\n年金制度の持続可能性を確保しつつ、年金受給者を含む中低所得の方々の手取りを「給付付き税額控除」で増やします。\n\n**▸ 社会保険料の見直し**\n現役世代の過重な負担を軽減しながら、世代間の公平性を確保した制度設計を進めます。\n\n**▸ 資産形成の支援**\nNISA制度の恒久化・拡充を実施済み。iDeCoの拡充も含め、老後に向けた個人の資産形成を幅広く支援します。\n\n**▸ 物価高対策**\n食料品の消費税免除により、年金生活者の皆様の実質的な購買力を守ります。\n\n老後の不安を少しでも解消し、安心してセカンドライフを送れる社会を目指しています。"
    },
    // === 住宅・家 ===
    {
        patterns: ["住宅", "家を買いたい", "マンション高い", "家賃高い", "住まい", "住居", "ローン", "住宅ローン", "持ち家", "賃貸", "不動産", "空き家"],
        categories: ["economy", "regional"],
        response: "住宅に関する政策についてお答えいたします。\n\n**▸ 住宅取得の支援**\n若い世代や子育て世帯が住宅を取得しやすい環境を整備します。住宅ローン減税の拡充や、新婚世帯向けの支援制度を進めます。\n\n**▸ 空き家対策**\n全国に約849万戸ある空き家について、リノベーション支援や利活用の促進を進めます。地方への移住を検討する方への住宅支援も充実させます。\n\n**▸ 金利・経済環境**\n「責任ある積極財政」で経済を成長軌道に乗せ、安定した雇用と賃金上昇を実現することで、住宅購入の基盤を整えます。\n\n**▸ スマートシティ**\nデジタル田園都市国家構想のもと、地方にも快適に暮らせる住環境を整備していきます。\n\n住まいの安心は生活の基盤です。しっかりと取り組んでまいります。"
    },
    // === 災害・防災 ===
    {
        patterns: ["地震", "災害", "台風", "津波", "豪雨", "防災", "避難", "耐震", "南海トラフ", "首都直下", "能登", "復興"],
        categories: ["regional", "constitution"],
        response: "災害対策と防災についてお答えいたします。\n\n**▸ 国土強靭化**\nインフラの老朽化対策、河川堤防の強化、ため池の整備など、国土強靭化に継続的に投資します。「危機管理投資」を政策の柱に据えています。\n\n**▸ 緊急事態への備え**\n大規模災害時に迅速に対応できるよう、憲法に緊急事態条項を整備することを目指しています。国会機能の維持と国民の権利保護を両立させます。\n\n**▸ デジタル防災**\n5G・AI技術を活用した早期警報システム、避難誘導アプリの整備など、デジタル技術で防災力を高めます。\n\n**▸ 被災地の復旧・復興**\n被災地の一日も早い復旧・復興に全力を尽くします。「まるごと小さな拠点」など、災害に強い地域づくりを進めます。\n\n国民の命と暮らしを守ることは、政治の最大の責任です。"
    },
    // === 外交・国際比較 ===
    {
        patterns: ["海外と比較", "他の国", "世界では", "外国は", "欧米", "先進国", "GDP", "国際競争力", "日本は遅れてる", "日本って先進国"],
        categories: ["economy", "digital", "security"],
        response: "日本の国際的な位置づけと目指す方向について、お答えいたします。\n\n**▸ 経済力の回復**\nかつて世界第2位だった日本のGDPは現在第4位ですが、「責任ある積極財政」と17の戦略分野への投資で、再び力強い経済成長を実現します。\n\n**▸ テクノロジーでの巻き返し**\nAI・半導体分野で10兆円超の公的支援を投入。TSMC熊本工場やラピダスなど、半導体の国産化で世界の供給網の中核を担います。\n\n**▸ 外交・安全保障**\n「自由で開かれたインド太平洋」の推進、日米同盟の強化、防衛費GDP2%の達成で、国際社会における日本のプレゼンスを高めます。\n\n**▸ 人材・教育**\n留学支援の拡充、英語教育の強化、飛び級制度の導入で、グローバルに活躍できる人材を育てます。\n\n日本は素晴らしい潜在力を持っています。その力を最大限に引き出す政治を実行します。"
    },
    // === 物価・生活コスト ===
    {
        patterns: ["物価高", "物価上がった", "値上がり", "高くなった", "食べ物高い", "スーパー高い", "卵", "米", "野菜", "食料品"],
        categories: ["economy", "energy"],
        response: "物価高騰への対策について、お答えいたします。\n\n**▸ 食料品の消費税免除**\nこれが最大の目玉政策です。2年間、食料品を消費税の課税対象から除外します。毎日の買い物で直接的な負担軽減を実感していただけます。\n\n**▸ エネルギーコストの抑制**\n電気料金・ガソリン価格の高騰に対し、エネルギー政策の抜本的見直しで中長期的にコストを下げます。原子力の安全な再稼働、再エネの推進がその柱です。\n\n**▸ 手取りの増加**\n「給付付き税額控除」で中低所得者の手取りを直接増やします。物価が上がっても、それ以上に収入が増える経済を目指します。\n\n**▸ 農業・食料自給率の向上**\nスマート農業の推進、農産物のブランド化で国内生産を強化し、輸入に頼りすぎない食料供給体制を構築します。\n\n物価高は国民生活に直結する最優先課題です。全力で取り組みます。"
    },
    // === 安全・治安 ===
    {
        patterns: ["治安", "犯罪", "安全", "詐欺", "闇バイト", "凶悪犯罪", "ストーカー", "不審者", "特殊詐欺", "オレオレ詐欺", "怖い"],
        categories: ["security", "digital"],
        response: "国民の安全と治安対策についてお答えいたします。\n\n**▸ サイバーセキュリティ**\n「能動的サイバー防御（ACD）」を導入し、サイバー攻撃を未然に防ぐ体制を構築します。個人情報や金融データの保護を強化します。\n\n**▸ 特殊詐欺・闇バイト対策**\n警察の人員強化とデジタル技術の活用で、特殊詐欺や闇バイトの撲滅に取り組みます。若者が犯罪に巻き込まれない社会を目指します。\n\n**▸ 外国人犯罪への対応**\n入管法の厳格な運用、不法滞在への対処を強化します。同時に、正規の外国人労働者との共生も進めます。\n\n**▸ 地域の安全**\n防犯カメラの整備、地域の見守りネットワーク、5Gを活用した緊急通報システムの高度化を推進します。\n\n安全に暮らせることは、すべての国民の基本的な権利です。"
    },
    // === 地方暮らし・移住 ===
    {
        patterns: ["田舎", "地方", "移住", "Uターン", "Iターン", "過疎", "東京一極集中", "地方に住みたい", "ふるさと", "故郷", "地元"],
        categories: ["regional"],
        response: "地方の活性化と移住支援についてお答えいたします。\n\n**▸ 東京一極集中の是正**\n「デジタル田園都市国家構想」のもと、地方にいても都市部と同じサービスが受けられる環境を整備します。政府機関の地方移転も進めます。\n\n**▸ 移住支援**\n地方への移住を希望する方への住宅支援、起業支援、子育て環境の整備を充実させます。テレワークの普及で「どこでも働ける」社会を実現します。\n\n**▸ 産業クラスターの形成**\n地域の強みを活かした産業クラスターを全国に展開。農業・漁業のスマート化、地場産業のデジタル化で雇用を創出します。\n\n**▸ インフラ整備**\n地方の道路・橋・トンネルの老朽化対策、5G通信網の整備、公共交通の維持に取り組みます。\n\n地方こそが日本の底力です。「まるごと小さな拠点」づくりで地方の魅力を最大化します。"
    },
    // === AIが奪う仕事 / テクノロジーへの不安 ===
    {
        patterns: ["AIに仕事奪われる", "仕事なくなる", "ロボットに代わられる", "AIが怖い", "技術の進歩が心配", "失業する", "AI脅威", "人間いらなくなる"],
        categories: ["digital", "economy", "education"],
        response: "AI・テクノロジーの進歩と雇用への影響について、お答えいたします。\n\n**▸ AI共生社会のビジョン**\nAIは人間の仕事を奪うものではなく、人間の能力を拡張するものと位置づけています。AI基本計画では「人間中心のAI社会」を掲げています。\n\n**▸ リスキリング（学び直し）**\nAI時代に必要なスキルを身につけられるよう、リスキリング支援を大幅に拡充します。社会人の学び直しを国として後押しします。\n\n**▸ 新しい雇用の創出**\nAI・デジタル分野だけで約160兆円の経済波及効果を見込んでいます。これにより、AIを活用した新しい産業や職種が多数生まれます。\n\n**▸ セーフティネット**\n働き方が変化しても安心できるよう、社会保障制度を時代に合わせて見直します。フリーランスの保護強化も進めます。\n\n変化を恐れるのではなく、変化を味方につける。それが私たちの方針です。"
    },
    // === 半導体・TSMC ===
    {
        patterns: ["半導体", "TSMC", "ラピダス", "Rapidus", "チップ", "半導体不足", "国産半導体"],
        categories: ["digital", "economy"],
        response: "半導体政策について、お答えいたします。\n\n**▸ 半導体の国産化**\nTSMC熊本工場の稼働支援やラピダス（Rapidus）による最先端2nm半導体の製造など、半導体の国内生産基盤を強化しています。\n\n**▸ 経済安全保障**\n半導体は「産業のコメ」と呼ばれる、あらゆる産業の基盤です。海外依存のリスクを減らし、サプライチェーンの強靭化を図ります。\n\n**▸ 「フィジカルAI」との連携**\nAI半導体の国内開発・製造を推進し、「フィジカルAI」（AIが物理世界を制御する技術）で世界をリードします。\n\n**▸ 人材育成**\n半導体人材の育成プログラムを全国に展開。九州の「シリコンアイランド」構想など、地方経済の活性化にも寄与します。\n\n半導体は日本の経済安全保障と未来の成長の鍵です。"
    },
    // === 自分は誰？ / 自己紹介 ===
    {
        patterns: ["あなたは誰", "自己紹介", "誰ですか", "何者", "何ができるの", "あなたは何", "このサイト", "何のサイト", "使い方"],
        categories: [],
        response: "ご質問ありがとうございます！\n\n私は第104代内閣総理大臣の**高市早苗**です。このサイトは、2026年の第51回衆議院選挙の結果と、私たち自民党の「政権公約2026」についてわかりやすくお伝えするためのQ&Aサイトです。\n\n**▸ できること**\n・政策について詳しく質問する（経済、安全保障、教育、子育て、エネルギーなど）\n・選挙結果について聞く\n・暮らしの不安や疑問を相談する\n・政策を比較したり、まとめて聞く\n\n**▸ 聞き方のコツ**\n・カジュアルな言葉でOKです（「給料上がる？」「電気代やばい」など）\n・「もっと詳しく」と言えば深掘りできます\n・複数トピックもOK（「子育てと仕事の両立」など）\n\n何でもお気軽にお聞きください！「日本列島を、強く豊かに。」"
    },
    // === 比較・どっちがいい系 ===
    {
        patterns: ["前の政権と比べ", "民主党時代", "安倍政権", "岸田政権", "前任", "歴代", "他の政党と比べ", "何が違う"],
        categories: ["economy", "security"],
        response: "私たちの政権の特徴と方向性について、お答えいたします。\n\n**▸ 「経済安全保障」が柱**\n私の政権の最大の特徴は、「経済安全保障」を政策の中心に据えていることです。経済と安全保障を一体として捉え、両方を同時に強化します。\n\n**▸ 責任ある積極財政**\n緊縮財政ではなく、必要な投資を大胆に行う「責任ある積極財政」を掲げています。17の戦略分野に集中投資し、成長を取り戻します。\n\n**▸ 初の女性総理**\n日本初の女性内閣総理大臣として、多様な視点を政策に活かしています。2025年12月時点で76.0%の支持率をいただいています。\n\n**▸ 2026年選挙の信任**\n第51回衆院選では316議席を獲得し、単独で3分の2を超える歴史的な勝利を収めました。この信任に応えるべく全力で取り組んでいます。\n\n過去に学びつつ、未来を見据えた政治を実行してまいります。"
    },
    // === 賛成・応援 ===
    {
        patterns: ["応援してます", "頑張って", "期待してます", "がんばれ", "支持します", "推してます", "ファン", "かっこいい", "素敵"],
        categories: [],
        response: "温かいお言葉、本当にありがとうございます！ 😊\n\n皆様からの応援が、私の最大の原動力です。「日本列島を、強く豊かに。」というビジョンの実現に向けて、一日一日全力で取り組んでまいります。\n\n選挙で316議席という歴史的な信任をいただきましたが、それは同時に大きな責任でもあります。期待を裏切らぬよう、具体的な成果でお応えしていきます。\n\n政策について気になることがあれば、いつでもお聞きください。国民の皆様との対話を大切にしてまいります。\n\n一緒に、強く豊かな日本を創りましょう！ 🇯🇵"
    },
    // === 批判・不満 ===
    {
        patterns: ["ダメ", "嫌い", "信用できない", "嘘つき", "無能", "期待はずれ", "失望", "ひどい", "最悪", "どうせ変わらない", "政治不信", "意味ない"],
        categories: [],
        response: "厳しいご意見、真摯に受け止めます。\n\n政治への不信感や失望を感じておられることは、私たち政治家が重く受け止めるべきことです。\n\n**▸ 結果で示す**\n言葉だけでなく、具体的な政策の実行と成果でお応えすることが最も重要だと考えています。食料品の消費税免除、手取りの増加、エネルギーコストの安定化など、生活に直結する変化を必ず届けます。\n\n**▸ 透明性の確保**\n政策の進捗をわかりやすく開示し、国民の皆様にチェックしていただける仕組みを充実させます。\n\n**▸ 対話の重視**\nこのように直接ご意見をいただける機会を大切にしています。批判的なご意見こそ、政策を改善する貴重なヒントです。\n\n具体的にどの分野に不満をお感じですか？ お聞かせいただければ、私たちの取り組みをお伝えします。"
    }
];

// ========================================
// 会話コンテキストメモリ（フォローアップ対応）
// ========================================
let conversationContext = {
    lastCategory: null,
    lastTopicId: null,
    turnCount: 0
};

// ========================================
// ファジーマッチング（レーベンシュタイン距離）
// ========================================
function levenshteinDistance(a, b) {
    const m = a.length, n = b.length;
    if (m === 0) return n;
    if (n === 0) return m;

    const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));
    for (let i = 0; i <= m; i++) dp[i][0] = i;
    for (let j = 0; j <= n; j++) dp[0][j] = j;

    for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
            dp[i][j] = Math.min(
                dp[i - 1][j] + 1,
                dp[i][j - 1] + 1,
                dp[i - 1][j - 1] + (a[i - 1] === b[j - 1] ? 0 : 1)
            );
        }
    }
    return dp[m][n];
}

function fuzzyMatch(query, keyword, threshold) {
    if (keyword.length < 3) return query.includes(keyword);
    // N-gram生成による部分一致
    for (let i = 0; i <= query.length - keyword.length; i++) {
        const sub = query.substring(i, i + keyword.length);
        if (levenshteinDistance(sub, keyword) <= threshold) return true;
    }
    return false;
}

// ========================================
// N-gram トークナイザー（2-gram, 3-gram）
// ========================================
function generateNgrams(text, n) {
    const grams = [];
    for (let i = 0; i <= text.length - n; i++) {
        grams.push(text.substring(i, i + n));
    }
    return grams;
}

// ========================================
// メイン応答エンジン（大幅強化版）
// ========================================
function findBestResponse(query) {
    const normalizedQuery = query.trim();
    const lowerQuery = normalizedQuery.toLowerCase();
    conversationContext.turnCount++;

    // ========== Phase 1: 挨拶チェック ==========
    const greetingPatterns = [
        "こんにちは", "はじめまして", "hello", "hi", "よろしく",
        "おはよう", "こんばんは", "やあ", "ども", "どうも",
        "お疲れ", "はろー", "ハロー", "hey", "初めまして",
        "お世話になります", "お邪魔します"
    ];
    for (const gw of greetingPatterns) {
        if (lowerQuery.includes(gw)) {
            return {
                type: "greeting",
                text: QA_RESPONSES.greeting[Math.floor(Math.random() * QA_RESPONSES.greeting.length)],
                category: null
            };
        }
    }

    // ========== Phase 2: お礼・感想への応答 ==========
    const thankYouPatterns = ["ありがとう", "サンキュー", "thanks", "なるほど", "わかりました", "了解", "理解した", "勉強になる", "参考になる", "すごい"];
    for (const tp of thankYouPatterns) {
        if (lowerQuery.includes(tp)) {
            const thankResponses = [
                "こちらこそ、ご関心をお持ちいただきありがとうございます！他にも気になることがあれば、何でもお聞きください。",
                "嬉しいお言葉、ありがとうございます。国民の皆様にしっかりと政策をお届けすることが私の使命です。他にご質問はありますか？",
                "ありがとうございます！政策について知っていただくことが、より良い日本を創る第一歩だと思っています。ぜひ他のテーマもお尋ねください。"
            ];
            return {
                type: "thanks",
                text: thankResponses[Math.floor(Math.random() * thankResponses.length)],
                category: null
            };
        }
    }

    // ========== Phase 3: 複合トピックチェック ==========
    for (const topic of COMPOSITE_TOPICS) {
        for (const pattern of topic.patterns) {
            if (lowerQuery.includes(pattern)) {
                return {
                    type: "composite",
                    text: topic.response,
                    category: null
                };
            }
        }
    }

    // ========== Phase 4: 同義語辞書マッチ（スコアリング）==========
    const categoryScores = {};
    let synonymMatched = false;

    for (const [synonym, catId] of Object.entries(SYNONYM_DICTIONARY)) {
        if (lowerQuery.includes(synonym.toLowerCase())) {
            if (!categoryScores[catId]) categoryScores[catId] = 0;
            categoryScores[catId] += synonym.length + 2; // 同義語マッチにボーナス
            synonymMatched = true;
        }
    }

    // ========== Phase 5: オリジナルキーワードマッチ ==========
    for (const category of POLICY_CATEGORIES) {
        if (!categoryScores[category.id]) categoryScores[category.id] = 0;
        for (const keyword of category.keywords) {
            if (lowerQuery.includes(keyword.toLowerCase())) {
                categoryScores[category.id] += keyword.length;
            }
        }
    }

    // ========== Phase 6: ファジーマッチング ==========
    if (!synonymMatched) {
        for (const category of POLICY_CATEGORIES) {
            for (const keyword of category.keywords) {
                if (keyword.length >= 3 && fuzzyMatch(lowerQuery, keyword.toLowerCase(), 1)) {
                    if (!categoryScores[category.id]) categoryScores[category.id] = 0;
                    categoryScores[category.id] += keyword.length * 0.5; // ファジーマッチは半分のスコア
                }
            }
        }
    }

    // ========== Phase 7: 特別トピック判定（選挙・総理・野党） ==========
    const specialTopicScores = {};
    const SPECIAL_MAP = {
        election: QA_RESPONSES.election,
        primeMinister: QA_RESPONSES.primeMinister,
        opposition: QA_RESPONSES.opposition,
        dissolution: QA_RESPONSES.dissolution
    };

    for (const [synonym, topicId] of Object.entries(SYNONYM_DICTIONARY)) {
        if (["election", "primeMinister", "opposition", "dissolution"].includes(topicId)) {
            if (lowerQuery.includes(synonym.toLowerCase())) {
                if (!specialTopicScores[topicId]) specialTopicScores[topicId] = 0;
                specialTopicScores[topicId] += synonym.length + 2;
            }
        }
    }

    // ========== Phase 8: スコア比較 — 特別トピック vs カテゴリ ==========
    let bestSpecialTopic = null;
    let bestSpecialScore = 0;
    for (const [topicId, score] of Object.entries(specialTopicScores)) {
        if (score > bestSpecialScore) {
            bestSpecialScore = score;
            bestSpecialTopic = topicId;
        }
    }

    let bestCategoryId = null;
    let bestCategoryScore = 0;
    for (const [catId, score] of Object.entries(categoryScores)) {
        // 特別トピックIDを除外
        if (!["election", "primeMinister", "opposition", "dissolution"].includes(catId)) {
            if (score > bestCategoryScore) {
                bestCategoryScore = score;
                bestCategoryId = catId;
            }
        }
    }

    // 特別トピックの方が高スコアならそちらを返す
    if (bestSpecialTopic && bestSpecialScore > bestCategoryScore) {
        conversationContext.lastCategory = null;
        conversationContext.lastTopicId = bestSpecialTopic;
        return {
            type: "special",
            text: SPECIAL_MAP[bestSpecialTopic],
            category: null
        };
    }

    // ========== Phase 9: カテゴリ応答の生成 ==========
    if (bestCategoryId && bestCategoryScore > 0) {
        const bestCategory = POLICY_CATEGORIES.find(c => c.id === bestCategoryId);
        if (bestCategory) {
            conversationContext.lastCategory = bestCategory;
            conversationContext.lastTopicId = bestCategoryId;
            return generateCategoryResponse(bestCategory, lowerQuery);
        }
    }

    // ========== Phase 10: フォローアップ（前回の話題の続き）==========
    if (conversationContext.lastCategory) {
        const followUpPatterns = [
            "もっと", "詳しく", "具体的", "他に", "それ以外", "別の",
            "続き", "さらに", "追加", "深く", "もう少し", "他は",
            "例えば", "実際", "いつ", "どうやって", "なぜ", "どこ"
        ];
        for (const fp of followUpPatterns) {
            if (lowerQuery.includes(fp)) {
                const cat = conversationContext.lastCategory;
                // 前回と異なるdetailsを表示
                return generateCategoryResponse(cat, lowerQuery, true);
            }
        }
    }

    // ========== Phase 11: N-gramベースの最終マッチング試行 ==========
    const queryBigrams = generateNgrams(lowerQuery, 2);
    let bigramBestCat = null;
    let bigramBestScore = 0;

    for (const category of POLICY_CATEGORIES) {
        let bigramScore = 0;
        const categoryText = (category.title + category.summary + category.keywords.join("")).toLowerCase();
        for (const detail of category.details) {
            const detailText = (detail.subtitle + detail.content).toLowerCase();
            for (const bg of queryBigrams) {
                if (detailText.includes(bg)) bigramScore += 1;
                if (categoryText.includes(bg)) bigramScore += 0.5;
            }
        }
        if (bigramScore > bigramBestScore) {
            bigramBestScore = bigramScore;
            bigramBestCat = category;
        }
    }

    if (bigramBestCat && bigramBestScore >= 3) {
        conversationContext.lastCategory = bigramBestCat;
        return generateCategoryResponse(bigramBestCat, lowerQuery);
    }

    // ========== Phase 12: マッチなし ==========
    return {
        type: "notFound",
        text: QA_RESPONSES.notFound[Math.floor(Math.random() * QA_RESPONSES.notFound.length)],
        category: null
    };
}

// ========================================
// カテゴリ応答テキストの生成
// ========================================
function generateCategoryResponse(category, query, isFollowUp = false) {
    // 質問タイプに応じた導入文
    const questionType = detectQuestionType(query);
    let intro = "";

    switch (questionType) {
        case "why":
            intro = `${category.icon} **${category.title}**に関する「なぜ」にお答えします。\n\n`;
            break;
        case "how":
            intro = `${category.icon} **${category.title}**の具体的な進め方についてお話しします。\n\n`;
            break;
        case "when":
            intro = `${category.icon} **${category.title}**のスケジュールについてお答えします。\n\n`;
            break;
        case "opinion":
            intro = `${category.icon} **${category.title}**についての私の考えをお話しします。\n\n`;
            break;
        default:
            if (isFollowUp) {
                intro = `${category.icon} **${category.title}**について、さらに詳しくお話しします。\n\n`;
            } else {
                const intros = [
                    `${category.icon} **${category.title}**について、お答えいたします。\n\n`,
                    `${category.icon} **${category.title}**に関するご質問ですね。お答えします。\n\n`,
                    `${category.icon} ご関心をいただきありがとうございます。**${category.title}**についてお話しします。\n\n`
                ];
                intro = intros[Math.floor(Math.random() * intros.length)];
            }
    }

    let responseText = intro;
    responseText += `${category.summary}を目指しています。\n\n`;

    // 質問に最も関連するdetailをランク付け
    let matchedDetails = [];
    for (const detail of category.details) {
        const detailText = (detail.subtitle + detail.content).toLowerCase();
        let detailScore = 0;

        // トークンマッチ
        const queryTokens = query.split(/[\s、。？！?!,.\u3000]+/).filter(t => t.length >= 1);
        for (const token of queryTokens) {
            if (token.length >= 2 && detailText.includes(token)) {
                detailScore += token.length;
            }
        }

        // N-gramマッチ
        const bigrams = generateNgrams(query, 2);
        for (const bg of bigrams) {
            if (detailText.includes(bg)) detailScore += 0.5;
        }

        matchedDetails.push({ detail, score: detailScore });
    }

    matchedDetails.sort((a, b) => b.score - a.score);

    // フォローアップ時はランダムに並べ替え（前回と違う情報を提供）
    if (isFollowUp) {
        matchedDetails = matchedDetails.sort(() => Math.random() - 0.5);
    }

    const topDetails = matchedDetails.slice(0, 3);

    for (const { detail } of topDetails) {
        responseText += `**▸ ${detail.subtitle}**\n${detail.content}\n\n`;
    }

    // 締めの言葉のバリエーション
    const closings = [
        "他にもご質問がございましたら、お気軽にどうぞ。",
        "さらに詳しく知りたい点があれば、ぜひお聞きください。",
        "この分野について、もっと具体的に知りたいことはありますか？",
        "関連するテーマについてもお答えできますので、何でもお尋ねください。"
    ];
    responseText += closings[Math.floor(Math.random() * closings.length)];

    return {
        type: "category",
        text: responseText,
        category: category
    };
}

// ========================================
// 質問タイプ検出
// ========================================
function detectQuestionType(query) {
    const lower = query.toLowerCase();
    if (/なぜ|なんで|どうして|理由|原因|根拠|背景/.test(lower)) return "why";
    if (/どうやって|どのように|具体的に|方法|やり方|進め方|手順|仕組み/.test(lower)) return "how";
    if (/いつ|何年|何月|時期|スケジュール|期限|目標年|期日/.test(lower)) return "when";
    if (/どう思う|意見|考え|賛成|反対|思い|信念|ビジョン/.test(lower)) return "opinion";
    return "general";
}
